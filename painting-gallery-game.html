<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Gallery Explorer</title>
    <link rel="stylesheet" href="global.da2a4795 (1).css">
    <link rel="stylesheet" href="src.3607d8e2 (1).css">
    <script src="https://cdn.jsdelivr.net/npm/globe.gl"></script>
    <style>
        body { margin: 0; }
        .game-container { display: flex; flex-direction: column; height: 100vh; position: relative; }
        .globe-section { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1; transition: filter 0.3s ease, opacity 0.3s ease; user-select: none; pointer-events: auto; }
        .globe-section.blurred { filter: blur(8px) brightness(0.3); }
        #globeViz { width: 100%; height: 100%; user-select: none; -webkit-user-drag: none; user-drag: none; }
        .content-overlay { position: relative; z-index: 2; height: 100vh; display: flex; flex-direction: column; pointer-events: none; }
        .content-overlay>* { pointer-events: auto; }
        .gallery-section { flex: 1; background: rgba(0, 0, 0, 0.8); border-top: 2px solid #fff; overflow-y: auto; padding: 20px; transition: opacity 0.3s ease; }
        .gallery-section.hidden { opacity: 0; pointer-events: none; }
        .paintings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .painting-card { border: 2px solid #fff; padding: 15px; background: rgba(17, 17, 17, 0.9); transition: all 0.3s ease; }
        .painting-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1); }
        .painting-title { font-size: 1.2em; margin-bottom: 5px; }
        .painting-author { font-size: 0.9em; color: #ccc; margin-bottom: 5px; }
        .painting-type { font-size: 0.8em; color: #999; margin-bottom: 10px; }
        .painting-image { width: 100%; height: auto; object-fit: contain; border: 1px solid #666; margin-bottom: 10px; max-height: 400px; min-height: 120px; }
        .loading { text-align: center; padding: 50px; font-size: 1.5em; }
        .error { color: #ff4757; text-align: center; padding: 20px; }
        
        /* Bidding System */
        .painting-card.wrapper.svelte-1pd0inp { border: 2px solid #fff; padding: 0; background: rgba(17, 17, 17, 0.9); transition: all 0.3s ease; min-height: 400px; position: relative; }
        .painting-card.wrapper.svelte-1pd0inp.over { border-color: grey; color: grey; }
        .painting-card.wrapper.svelte-1pd0inp:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1); }
        .bids.svelte-1pd0inp { padding: 0 !important; margin: 0; width: 100%; position: relative; }
        .bid-button { background: #000; color: #fff; border: 2px solid #fff; padding: 6px 12px; cursor: pointer; font-size: 0.8em; text-align: center; min-width: 60px; border-radius: 0; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); z-index: 10; }
        .bid-button:hover { background: #fff; color: #000; transform: translateX(-50%) scale(1.05); }
        .bid-button-text { font-weight: bold; margin-bottom: 2px; }
        .bid-button-amount { font-size: 0.9em; }
        .bid-display.svelte-1nlw3im { width: 100%; padding: 10px 15px; margin: 0; position: relative; display: flex; justify-content: space-between; align-items: center; min-height: 60px; transition: all 0.3s ease; animation: svelte-1nlw3im-pop-in 0.45s; }
        .bid-display:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .timer-section { text-align: left; }
        .timer-number { font-size: 1.8em; font-weight: bold; color: #fff; line-height: 1; opacity: 1; }
        .timer-text { font-size: 0.7em; color: #fff; margin-top: 2px; opacity: 1; }
        .bid-info { text-align: center; flex-grow: 1; }
        .current-bid-label { font-size: 0.9em; color: #fff; margin-bottom: 2px; opacity: 1; }
        .current-bid-amount { font-size: 1.3em; font-weight: bold; color: #fff; opacity: 1; }
        .script.svelte-1pd0inp.svelte-1pd0inp { padding-bottom: 200px; border: none !important; border-bottom: .75px solid #fff !important; }
        .center.svelte-1pd0inp { margin-bottom: 0; }
        .left.svelte-1pd0inp { margin-top: 0; padding: 0; width: 100%; }
        .painting-meters.svelte-1pd0inp.svelte-1pd0inp { overflow: visible !important; padding-top: 6px !important; padding-bottom: 6px !important; }
        .painting-meter-section.city-section { display: flex !important; align-items: center !important; justify-content: center !important; font-size: 0 !important; transform: scaleY(1.75) !important; z-index: 10 !important; position: relative !important; }
        .painting-meter-section.city-section::after { content: attr(data-city) !important; font-size: 10px !important; font-weight: bold !important; color: white !important; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8) !important; transform: scaleY(0.571) !important; display: flex !important; align-items: center !important; justify-content: center !important; z-index: 25 !important; position: relative !important; }
        .painting-meter-section.after-city { background: rgba(25, 25, 25, 0.9) !important; }
        .painting-meter-sections { position: relative !important; }
        .painting-reliability-overlay { mix-blend-mode: normal !important; }
        .painting-image { margin-bottom: 5px !important; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="globe-section">
            <div id="globeViz"></div>
        </div>
        <div class="content-overlay">
            <header style="padding: 10px; background-color: rgba(40, 44, 52, 0.9); color: white; font-size: 12px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center; justify-content: space-between;">
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div>
                            <h3 style="margin: 0 0 5px 0; font-size: 14px;">Game Controls</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="setGamePhase('nomination')" style="padding: 6px 10px; background-color: #555; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;" id="nominationBtn">Nomination</button>
                                <button onclick="setGamePhase('bidding')" style="padding: 6px 10px; background-color: #555; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;" id="biddingBtn">Bidding Phase</button>
                                <button onclick="setGamePhase('travel')" style="padding: 6px 10px; background-color: #555; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;" id="travelBtn">Travel</button>
                                <button onclick="resetGame()" style="padding: 6px 10px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">Reset Game</button>
                            </div>
                        </div>
                        <div>
                            <h3 style="margin: 0 0 5px 0; font-size: 14px;">Player Status</h3>
                            <div style="display: flex; gap: 15px; font-size: 11px;">
                                <div><strong style="color: #00FFFF;">Player 1:</strong> <span id="player1Count">0</span> countries
                                    <div style="font-size: 10px; color: #ccc; max-width: 150px;" id="player1Countries"></div>
                                </div>
                                <div><strong style="color: #FF00FF;">Player 2:</strong> <span id="player2Count">0</span> countries
                                    <div style="font-size: 10px; color: #ccc; max-width: 150px;" id="player2Countries"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 11px; color: #ccc;" id="gameStatus">
                            <div id="roundStatus">1 / 3 rounds of nominate, auction</div>
                            <div id="stageStatus">1/3 nomination - next stage: bidding</div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="gallery-section" id="gallerySection">
                <div id="paintingsContainer">
                    <div class="loading">Loading paintings...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AIRTABLE_CONFIG = {
            BASE_ID: 'appSi99NbW1qy1xsm',
            TABLE_ID: 'tblwcIWe5P2z23FQO',
            TOKEN: 'patb4z3LhPCbWFvOV.d8ae4647cd7202bd3d5962ad22503bdc7e1f4e46f0ef2bf723e7bee04cef4fe3'
        };

        const EXPECTED_FIELDS = ['Original name', 'Short Title', 'Artist', 'Year', 'Region', 'Photo', 'Harmony'];

        let gamePhase = 'bidding', currentRound = 1, totalRounds = 3, travelCount = 0, maxTravels = 3;
        let playerCountries = { player1: [], player2: [] };
        let globe;

        const cities = [
            { name: 'New York', lat: 40.7128, lng: -74.0060, region: 'north america', popularity: 9, iata: 'JFK' },
            { name: 'London', lat: 51.5074, lng: -0.1278, region: 'europe', popularity: 8, iata: 'LHR' },
            { name: 'Paris', lat: 48.8566, lng: 2.3522, region: 'europe', popularity: 9, iata: 'CDG' },
            { name: 'Tokyo', lat: 35.6762, lng: 139.6503, region: 'east asia', popularity: 7, iata: 'NRT' },
            { name: 'Berlin', lat: 52.5200, lng: 13.4050, region: 'europe', popularity: 6, iata: 'TXL' },
            { name: 'Rome', lat: 41.9028, lng: 12.4964, region: 'europe', popularity: 8, iata: 'FCO' },
            { name: 'Sydney', lat: -33.8688, lng: 151.2093, region: 'oceania', popularity: 5, iata: 'SYD' },
            { name: 'Cairo', lat: 30.0444, lng: 31.2357, region: 'africa', popularity: 4, iata: 'CAI' },
            { name: 'Mumbai', lat: 19.0760, lng: 72.8777, region: 'south asia', popularity: 6, iata: 'BOM' },
            { name: 'São Paulo', lat: -23.5505, lng: -46.6333, region: 'south america', popularity: 5, iata: 'GRU' }
        ];

        function csvParseRows(csvText, parseFunction) {
            return csvText.split('\n').filter(line => line.trim()).map(line => {
                const fields = line.split(',').map(field => field.replace(/^"/, '').replace(/"$/, ''));
                return parseFunction(fields);
            }).filter(Boolean);
        }

        class ArtGalleryGame {
            constructor() {
                this.paintings = [];
                this.regionColors = {
                    'north america': 'blue', 'south america': 'red', 'oceania': 'lime',
                    'europe': 'cyan', 'africa': 'yellow', 'south asia': 'orange', 'east asia': 'darkred'
                };
                this.init();
            }

            async init() {
                this.initGlobe();
                await this.fetchPaintings();
                this.renderPaintings();
                this.updateUI();
            }

            async initGlobe() {
                try {
                    const globeElement = document.getElementById('globeViz');
                    if (!globeElement || typeof Globe === 'undefined') return;

                    globe = new Globe(globeElement)
                        .globeImageUrl('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png')
                        .backgroundColor('rgba(0,0,0,1)')
                        .labelsData(cities)
                        .labelLat(d => d.lat)
                        .labelLng(d => d.lng)
                        .labelText(d => d.name)
                        .labelSize(d => Math.sqrt(d.popularity) * 1.2)
                        .labelDotRadius(d => Math.sqrt(d.popularity) * 0.6)
                        .labelColor(() => 'rgba(255, 165, 0, 1.0)')
                        .labelResolution(2)
                        .onLabelClick(label => this.handleCityClick(label))
                        .arcLabel(d => `${d.airline}: ${d.srcIata} → ${d.dstIata}`)
                        .arcStartLat(d => d.srcAirport.lat)
                        .arcStartLng(d => d.srcAirport.lng)
                        .arcEndLat(d => d.dstAirport.lat)
                        .arcEndLng(d => d.dstAirport.lng)
                        .arcColor(d => [`rgba(0, 255, 0, 0.3)`, `rgba(255, 0, 0, 0.3)`])
                        .arcDashLength(0.4)
                        .arcDashGap(0.2)
                        .arcDashAnimateTime(1500)
                        .onArcHover(hoverArc => {
                            globe.arcColor(d => {
                                const op = !hoverArc ? 0.3 : d === hoverArc ? 0.9 : 0.3 / 4;
                                return [`rgba(0, 255, 0, ${op})`, `rgba(255, 0, 0, ${op})`];
                            });
                        });

                    await this.loadFlightData();
                    
                    globeElement.addEventListener('dragstart', e => e.preventDefault());
                    globeElement.addEventListener('selectstart', e => e.preventDefault());

                    const resizeGlobe = () => {
                        if (globe && globe.renderer && globeElement.clientWidth > 0) {
                            globe.renderer().setSize(globeElement.clientWidth, globeElement.clientHeight);
                            globe.camera().aspect = globeElement.clientWidth / globeElement.clientHeight;
                            globe.camera().updateProjectionMatrix();
                        }
                    };

                    [100, 500, 1000].forEach(delay => setTimeout(resizeGlobe, delay));
                    window.addEventListener('resize', resizeGlobe);
                } catch (error) {
                    console.error('Error initializing globe:', error);
                }
            }

            async loadFlightData() {
                try {
                    const [airportsRes, routesRes] = await Promise.all([
                        fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat'),
                        fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/routes.dat')
                    ]);

                    const airports = csvParseRows(await airportsRes.text(),
                        ([id, name, city, country, iata, icao, lat, lng]) =>
                            ({ iata, city, country, lat: +lat, lng: +lng }));

                    const routes = csvParseRows(await routesRes.text(),
                        ([airline, id, srcIata, srcId, dstIata, dstId, share, stops]) =>
                            ({ airline, srcIata, dstIata, stops }));

                    const cityIatas = cities.map(c => c.iata);
                    const airportMap = {};
                    airports.filter(a => cityIatas.includes(a.iata)).forEach(a => airportMap[a.iata] = a);

                    const arcs = routes
                        .filter(r => r.stops === '0' && airportMap[r.srcIata] && airportMap[r.dstIata])
                        .map(r => ({ ...r, srcAirport: airportMap[r.srcIata], dstAirport: airportMap[r.dstIata] }));

                    globe.arcsData(arcs);
                } catch (error) {
                    console.error('Flight data load failed:', error);
                    globe.arcsData([]);
                }
            }

            handleCityClick(city) {
                if (gamePhase === 'nomination') {
                    const currentPlayer = playerCountries.player1.length <= playerCountries.player2.length ? 'player1' : 'player2';
                    if (!playerCountries[currentPlayer].includes(city.name)) {
                        playerCountries[currentPlayer].push(city.name);
                        this.updateUI();
                    }
                } else if (gamePhase === 'travel') {
                    travelCount++;
                    this.updateUI();
                    if (travelCount >= maxTravels) this.advanceRound();
                }
            }

            advanceRound() {
                if (currentRound < totalRounds) {
                    currentRound++;
                    travelCount = 0;
                    gamePhase = 'nomination';
                } else {
                    gamePhase = 'complete';
                }
                this.updateUI();
            }

            updateUI() {
                document.getElementById('player1Count').textContent = playerCountries.player1.length;
                document.getElementById('player2Count').textContent = playerCountries.player2.length;
                document.getElementById('player1Countries').textContent = playerCountries.player1.join(', ');
                document.getElementById('player2Countries').textContent = playerCountries.player2.join(', ');

                this.updateGameStatus();

                document.querySelectorAll('header button').forEach(btn => btn.style.backgroundColor = '#555');
                const activeBtn = document.getElementById(gamePhase + 'Btn') || 
                    (gamePhase === 'nomination' ? document.querySelector('button[onclick*="nomination"]') : null);
                if (activeBtn) activeBtn.style.backgroundColor = '#4CAF50';

                const gallerySection = document.getElementById('gallerySection');
                const globeSection = document.querySelector('.globe-section');

                if (gamePhase === 'travel') {
                    gallerySection.classList.add('hidden');
                    globeSection.classList.remove('blurred');
                } else {
                    gallerySection.classList.remove('hidden');
                    globeSection.classList.add('blurred');
                }
            }

            updateGameStatus() {
                const roundStatus = document.getElementById('roundStatus');
                const stageStatus = document.getElementById('stageStatus');

                if (gamePhase === 'complete') {
                    roundStatus.textContent = 'Game Complete!';
                    stageStatus.textContent = 'All rounds finished';
                    return;
                }

                roundStatus.textContent = `${currentRound} / ${totalRounds} rounds of nominate, auction`;

                let stageText = '', nextStage = '';
                if (gamePhase === 'nomination') {
                    stageText = `${currentRound}/3 nomination`;
                    nextStage = 'bidding';
                } else if (gamePhase === 'bidding') {
                    stageText = `${currentRound}/3 bidding`;
                    nextStage = 'travel';
                } else if (gamePhase === 'travel') {
                    stageText = `${travelCount}/${maxTravels} travel`;
                    nextStage = travelCount >= maxTravels ? 
                        (currentRound < totalRounds ? 'next round' : 'game complete') : 'continue travel';
                }

                stageStatus.textContent = `${stageText} - next stage: ${nextStage}`;
            }

            async fetchPaintings() {
                try {
                    if (!AIRTABLE_CONFIG.TOKEN || AIRTABLE_CONFIG.TOKEN === 'YOUR_AIRTABLE_TOKEN_HERE') {
                        this.paintings = this.getFallbackPaintings();
                        return;
                    }

                    const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLE_ID}`;
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_CONFIG.TOKEN}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`Airtable API error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    if (!data.records || data.records.length === 0) {
                        this.paintings = this.getFallbackPaintings();
                        return;
                    }

                    this.paintings = data.records.map(record => {
                        const fields = record.fields;
                        return {
                            id: record.id,
                            title: fields['Short Title'] || fields['Original name'] || 'Untitled',
                            originalName: fields['Original name'] || '',
                            author: fields['Artist'] || 'Unknown Artist',
                            year: fields['Year'] ? String(fields['Year']) : 'Unknown',
                            type: fields['Harmony'] || 'Unknown Style',
                            region: this.mapRegionFromTags(fields['Region']),
                            image: this.extractImageUrl(fields['Photo']),
                            description: fields['Harmony'] || '',
                            harmony: fields['Harmony'] || '',
                            regionTags: fields['Region'] || []
                        };
                    }).filter(p => (p.title && p.title !== 'Untitled') || (p.author && p.author !== 'Unknown Artist'));

                    if (this.paintings.length === 0) {
                        this.paintings = this.getFallbackPaintings();
                    }
                } catch (error) {
                    console.error('Error fetching paintings from Airtable:', error);
                    this.paintings = this.getFallbackPaintings();
                }
            }

            getFallbackPaintings() {
                return [
                    { title: "The Starry Night", author: "Vincent van Gogh", year: "1889", type: "Post-Impressionism", region: "europe", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg/300px-Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg" },
                    { title: "The Great Wave", author: "Katsushika Hokusai", year: "1831", type: "Ukiyo-e", region: "east asia", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/The_Great_Wave_off_Kanagawa.jpg/300px-The_Great_Wave_off_Kanagawa.jpg" },
                    { title: "Mona Lisa", author: "Leonardo da Vinci", year: "1503", type: "Renaissance", region: "europe", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg/300px-Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg" },
                    { title: "American Gothic", author: "Grant Wood", year: "1930", type: "Regionalism", region: "north america", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Grant_Wood_-_American_Gothic_-_Google_Art_Project.jpg/300px-Grant_Wood_-_American_Gothic_-_Google_Art_Project.jpg" },
                    { title: "Girl with a Pearl Earring", author: "Johannes Vermeer", year: "1665", type: "Baroque", region: "europe", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/1665_Girl_with_a_Pearl_Earring.jpg/300px-1665_Girl_with_a_Pearl_Earring.jpg" },
                    { title: "The Persistence of Memory", author: "Salvador Dalí", year: "1931", type: "Surrealism", region: "europe", image: "https://upload.wikimedia.org/wikipedia/en/thumb/d/dd/The_Persistence_of_Memory.jpg/300px-The_Persistence_of_Memory.jpg" }
                ];
            }

            mapRegionFromTags(regionTags) {
                if (!regionTags) return 'europe';

                let tags = Array.isArray(regionTags) ? regionTags : typeof regionTags === 'string' ? [regionTags] : [];
                if (tags.length === 0) return 'europe';

                const tagToRegionMap = {
                    'European Art': 'europe', 'european art': 'europe', 'europe': 'europe', 'western art': 'europe', 'renaissance': 'europe', 'baroque': 'europe', 'impressionism': 'europe',
                    'South American Art': 'south america', 'south american art': 'south america', 'south america': 'south america', 'latin american art': 'south america', 'brazilian art': 'south america', 'mexican art': 'south america',
                    'North American Art': 'north america', 'north american art': 'north america', 'north america': 'north america', 'american art': 'north america', 'usa art': 'north america', 'canadian art': 'north america',
                    'East Asian Art': 'east asia', 'east asian art': 'east asia', 'east asia': 'east asia', 'asian art': 'east asia', 'chinese art': 'east asia', 'japanese art': 'east asia', 'korean art': 'east asia',
                    'South Asian Art': 'south asia', 'south asian art': 'south asia', 'south asia': 'south asia', 'indian art': 'south asia', 'buddhist art': 'south asia', 'hindu art': 'south asia',
                    'African Art': 'africa', 'african art': 'africa', 'africa': 'africa', 'egyptian art': 'africa', 'tribal art': 'africa',
                    'Oceanian Art': 'oceania', 'oceanian art': 'oceania', 'oceania': 'oceania', 'australian art': 'oceania', 'aboriginal art': 'oceania', 'pacific art': 'oceania'
                };

                for (const tag of tags) {
                    if (!tag) continue;
                    const tagLower = String(tag).toLowerCase().trim();
                    if (tagToRegionMap[tagLower]) return tagToRegionMap[tagLower];
                }
                return 'europe';
            }

            extractImageUrl(imageField) {
                if (!imageField) return null;
                if (Array.isArray(imageField) && imageField.length > 0) {
                    const attachment = imageField[0];
                    return attachment.url || attachment.thumbnails?.large?.url || attachment.thumbnails?.full?.url || attachment.thumbnails?.small?.url;
                }
                if (typeof imageField === 'string' && imageField.trim()) return imageField.trim();
                if (imageField && typeof imageField === 'object' && imageField.url) return imageField.url;
                return null;
            }

            initializeBiddingData() {
                this.biddingData = this.paintings.map((painting, index) => ({
                    paintingId: index,
                    currentBid: 2.5,
                    currentTeam: index % 3,
                    timeRemaining: 15.750,
                    isActive: true
                }));
            }

            getCurrentTeamColor(paintingIndex) {
                return ['cyan', 'magenta', 'lime'][paintingIndex % 3];
            }

            getCurrentTeamColorRGBA(paintingIndex, opacity = 0.1) {
                const colorMap = {
                    'cyan': `rgba(0, 255, 255, ${opacity})`,
                    'magenta': `rgba(255, 0, 255, ${opacity})`,
                    'lime': `rgba(0, 255, 0, ${opacity})`
                };
                return colorMap[this.getCurrentTeamColor(paintingIndex)];
            }

            renderPaintings() {
                const container = document.getElementById('paintingsContainer');
                if (!container) return;

                if (gamePhase === 'bidding') this.initializeBiddingData();

                if (this.paintings.length === 0) {
                    container.innerHTML = '<div class="error">No paintings found.</div>';
                    return;
                }

                const grid = document.createElement('div');
                grid.className = 'paintings-grid';

                this.paintings.forEach((painting, index) => {
                    const card = document.createElement('div');
                    card.className = 'painting-card';
                    card.style.borderColor = this.regionColors[painting.region] || '#fff';

                    if (gamePhase === 'bidding') {
                        card.className = 'painting-card wrapper svelte-1pd0inp';
                        card.innerHTML = `
                            <div class="center svelte-1pd0inp">
                                <div class="script svelte-1pd0inp">
                                    <h1 class="svelte-1pd0inp">${painting.title}</h1>
                                    <div class="detail svelte-1pd0inp">${painting.author} | ${painting.year}</div>
                                    <div class="detail svelte-1pd0inp">${painting.type}</div>
                                    <img class="painting-image" src="${painting.image}" alt="${painting.title}" 
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4='" style="width: 100%; height: auto; object-fit: contain; margin: 10px 0; max-height: 300px; min-height: 120px;">
                                    <div class="painting-meters svelte-1pd0inp">
                                        ${this.generateCityMeters(painting, index)}
                                    </div>
                                </div>
                            </div>
                            <div class="left svelte-1pd0inp">
                                <div class="bids svelte-1pd0inp" data-painting-id="${index}">
                                    <button class="bid-button" data-painting-id="${index}">
                                        <div class="bid-button-text">Bid</div>
                                        <div class="bid-button-amount">$3.0M</div>
                                    </button>
                                    <div class="bid-display svelte-1nlw3im" style="background-color: ${this.getCurrentTeamColorRGBA(index, 0.1)}; border: 3px solid ${this.getCurrentTeamColor(index)};" data-painting-id="${index}">
                                        <div class="timer-section">
                                            <div class="timer-number">15.750</div>
                                            <div class="timer-text">Sec. remaining</div>
                                        </div>
                                        <div class="bid-info">
                                            <div class="current-bid-label">Current bid:</div>
                                            <div class="current-bid-amount">$2.5M</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;

                        const bidButton = card.querySelector('.bid-button');
                        if (bidButton) {
                            bidButton.addEventListener('click', (e) => {
                                e.stopPropagation();
                                this.handleBidClick(card, index);
                            });
                        }

                        this.startBiddingTimer(card, index);

                        card.addEventListener('click', (e) => {
                            if (!e.target.closest('.bid-button') && !e.target.closest('.bid-display')) {
                                this.showPaintingDetails(painting);
                            }
                        });
                    } else {
                        card.innerHTML = `
                            <div class="painting-title title-font">${painting.title}</div>
                            <div class="painting-author">${painting.author} | ${painting.year}</div>
                            <div class="painting-type">${painting.type}</div>
                            <img class="painting-image" src="${painting.image}" alt="${painting.title}" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4='">
                        `;
                        card.addEventListener('click', () => this.showPaintingDetails(painting));
                    }

                    grid.appendChild(card);
                });

                container.innerHTML = '';
                container.appendChild(grid);
            }

            generateCityMeters(painting, index) {
                const cityOffsets = {
                    'darkred': [0, 3, 0, 4, 0, 2, 1, 1, 3, 4, 2, 3],
                    'red': [0, 2, 0, 2, 2, 2, 2, 2, 4, 4, 1, 4],
                    'cyan': [0, 2, 0, 1, 1, 4, 1, 1, 4, 1, 1, 3],
                    'orange': [0, 4, 3, 2, 2, 2, 0, 4, 4, 0, 2, 3],
                    'yellow': [1, 4, 0, 2, 4, 2, 2, 1, 3, 1, 0, 2],
                    'blue': [1, 3, 0, 2, 1, 3, 4, 1, 4, 2, 1, 4],
                    'lime': [0, 4, 1, 4, 3, 2, 1, 2, 3, 1, 4, 3],
                    'magenta': [5, 1, 5, 2, 0, 3, 3, 2, 2, 0, 2, 1]
                };

                const cities = ['cai', 'cpt', 'dxb', 'jak', 'lag', 'ldn', 'mxc', 'mum', 'nyc', 'sao', 'syd', 'tyo'];
                const regionColor = this.regionColors[painting.region] || 'blue';
                const harmonyColor = regionColor;

                return Array.from({ length: 12 }, (_, i) => {
                    if (i >= cities.length) return '';

                    const cityForThisRow = cities[i];
                    let position;

                    if (cityOffsets[harmonyColor] && Array.isArray(cityOffsets[harmonyColor])) {
                        const offset = cityOffsets[harmonyColor][i] || 0;

                        if (harmonyColor === 'magenta') {
                            position = offset;
                        } else {
                            const baseNumber = index % 6;
                            position = baseNumber + offset;
                        }

                        position = Math.max(0, Math.min(9, position));
                    } else {
                        position = index % 10;
                    }

                    // Calculate painting reliability - extends from city center to specific block boundaries
                    // This creates a white gradient overlay that starts at the center of the city block and extends
                    // bidirectionally to block boundaries (0.5, 1.5, 2.5, 3.5, etc.) without crossing min/max values
                    const minValue = 0;
                    const maxValue = 9;
                    const cityValue = position;
                    const cityCenterValue = cityValue + 0.5; // Center of the city block
                    
                    // Calculate how many full blocks we can extend in each direction
                    const maxBlocksLeft = Math.floor(cityCenterValue - minValue);
                    const maxBlocksRight = Math.floor((maxValue + 1) - cityCenterValue);
                    const maxBlocks = Math.min(maxBlocksLeft, maxBlocksRight); // No artificial cap
                    
                    // Minimum reliability is 0.5 (covers the full city block)
                    // Then randomly extend to 1.5, 2.5, 3.5, etc. (to block boundaries)
                    const minReliability = 0.5;
                    const additionalBlocks = Math.floor(Math.random() * maxBlocks); // 0, 1, 2, or 3 additional blocks
                    const reliability = minReliability + additionalBlocks; // 0.5, 1.5, 2.5, or 3.5
                    
                    const reliabilityStartPos = Math.max(minValue, cityCenterValue - reliability);
                    const reliabilityEndPos = Math.min(maxValue + 1, cityCenterValue + reliability);

                    return `
                        <div class="painting-meter-row svelte-1pd0inp">
                            <div class="painting-meter-sections svelte-1pd0inp">
                                ${Array.from({ length: 10 }, (_, j) => {
                                    let sectionClass = 'painting-meter-section svelte-1pd0inp';
                                    let sectionContent = '';
                                    
                                    if (j === position) {
                                        sectionClass += ' city-section';
                                        sectionContent = cityForThisRow.toUpperCase();
                                    } else if (j > position) {
                                        sectionClass += ' after-city';
                                    }
                                    
                                    return `<div class="${sectionClass}" data-city="${cityForThisRow.toUpperCase()}">${sectionContent}</div>`;
                                }).join('')}
                                <div class="painting-reliability-overlay" style="
                                    position: absolute;
                                    top: 0;
                                    left: ${reliabilityStartPos * 10}%;
                                    width: ${(reliabilityEndPos - reliabilityStartPos) * 10}%;
                                    height: 100%;
                                    background: linear-gradient(90deg, transparent 1%, rgba(255,255,255,0.4) 25%, rgba(255,255,255,0.4) 75%, transparent 99%);
                                    pointer-events: none;
                                    z-index: 15;
                                "></div>
                            </div>
                        </div>
                    `;
                }).filter(row => row !== '').join('');
            }

            handleBidClick(card, paintingIndex) {
                const bidData = this.biddingData[paintingIndex];
                const colors = ['cyan', 'magenta', 'lime'];

                bidData.currentBid += 0.5;
                bidData.currentTeam = (bidData.currentTeam + 1) % 3;
                const newTeamColor = colors[bidData.currentTeam];

                const bidDisplay = card.querySelector('.bid-display');
                const currentBidElement = card.querySelector('.current-bid-amount');
                const bidButton = card.querySelector('.bid-button');
                const buttonAmount = bidButton.querySelector('.bid-button-amount');

                const colorMap = {
                    'cyan': 'rgba(0, 255, 255, 0.1)',
                    'magenta': 'rgba(255, 0, 255, 0.1)',
                    'lime': 'rgba(0, 255, 0, 0.1)'
                };
                bidDisplay.style.backgroundColor = colorMap[newTeamColor];
                bidDisplay.style.borderColor = newTeamColor;
                currentBidElement.textContent = `${bidData.currentBid.toFixed(1)}M`;
                buttonAmount.textContent = `${(bidData.currentBid + 0.5).toFixed(1)}M`;

                bidDisplay.classList.remove('svelte-1nlw3im');
                setTimeout(() => bidDisplay.classList.add('svelte-1nlw3im'), 10);
            }

            startBiddingTimer(card, paintingIndex) {
                const bidData = this.biddingData[paintingIndex];
                const timerNumber = card.querySelector('.timer-number');

                const timer = setInterval(() => {
                    bidData.timeRemaining -= 0.001;

                    if (bidData.timeRemaining <= 0) {
                        clearInterval(timer);
                        bidData.timeRemaining = 0;
                        this.endBidding(card);
                    }

                    timerNumber.textContent = bidData.timeRemaining.toFixed(3);
                }, 1);

                card.dataset.timerId = timer;
            }

            endBidding(card) {
                card.classList.add('over');
                const script = card.querySelector('.script');
                if (script) script.classList.add('over');

                const bidButton = card.querySelector('.bid-button');
                if (bidButton) {
                    bidButton.disabled = true;
                    bidButton.style.opacity = '0.5';
                    bidButton.style.cursor = 'not-allowed';
                }
            }

            showPaintingDetails(painting) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.9); display: flex; justify-content: center;
                    align-items: center; z-index: 1000;
                `;

                modal.innerHTML = `
                    <div style="background: #000; border: 2px solid ${this.regionColors[painting.region]}; padding: 30px; max-width: 500px; text-align: center;">
                        <h2 class="title-font">${painting.title}</h2>
                        <p><strong>${painting.author}</strong> | ${painting.year}</p>
                        <p>${painting.type}</p>
                        <img src="${painting.image}" style="max-width: 100%; height: auto; margin: 20px 0;" alt="${painting.title}">
                        <br>
                        <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: #fff; color: #000; border: none; cursor: pointer;">Close</button>
                    </div>
                `;

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });

                document.body.appendChild(modal);
            }
        }

        function setGamePhase(phase) {
            if (phase === 'travel') travelCount = 0;
            gamePhase = phase;
            if (window.game) {
                window.game.updateUI();
                window.game.renderPaintings();
            }
        }

        function resetGame() {
            currentRound = 1;
            travelCount = 0;
            playerCountries = { player1: [], player2: [] };
            gamePhase = 'nomination';
            if (window.game) window.game.updateUI();
        }

        document.addEventListener('DOMContentLoaded', () => {
            function initializeGame() {
                try {
                    window.game = new ArtGalleryGame();
                } catch (error) {
                    console.error('Error initializing game:', error);
                }
            }

            setTimeout(() => {
                if (typeof Globe === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/globe.gl';
                    script.onload = () => setTimeout(initializeGame, 200);
                    script.onerror = () => {
                        const altScript = document.createElement('script');
                        altScript.src = 'https://unpkg.com/globe.gl';
                        altScript.onload = () => setTimeout(initializeGame, 200);
                        altScript.onerror = () => initializeGame();
                        document.head.appendChild(altScript);
                    };
                    document.head.appendChild(script);
                } else {
                    initializeGame();
                }
            }, 100);
        });
    </script>
</body>
</html>
                    '